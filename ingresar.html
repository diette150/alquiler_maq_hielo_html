<!doctype html>
<html lang="es">
<head><meta charset="utf-8"><title>Ingresar datos</title></head>
<body>
  <h2>Ingresar datos para la máquina (usar cuando estés conectado al AP del ESP)</h2>
  <p>Conecta tu teléfono/PC al WiFi del ESP (ej: IceMaker_Config_xxx). Luego abre <strong>http://192.168.4.1</strong> o usa este formulario (si el navegador permite el POST).</p>

  <form id="f">
    Maquina ID: <input name="maquina_id" required><br>
    Nombre cliente: <input name="nombre_cliente"><br>
    Teléfono: <input name="telefono"><br>
    Dirección: <input name="direccion"><br>
    WiFi SSID: <input name="wifi_ssid"><br>
    WiFi Password: <input name="wifi_pass" type="password"><br>
    Backend URL (ej: http://mi-ip:3100): <input name="backend_url" value="http://localhost:3100"><br>
    <button>Enviar al ESP (AP)</button>
  </form>

  <script>
    document.getElementById('f').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new URLSearchParams(new FormData(e.target));
      try {
        // Intento de enviar al servidor del ESP (AP 192.168.4.1). 
        // Si el navegador bloquea por CORS, abre directamente http://192.168.4.1 en tu navegador.
        await fetch('http://192.168.4.1/save', { method: 'POST', body: data, mode: 'no-cors' });
        alert('Formulario enviado al ESP. Si no funciona, abre http://192.168.4.1 en el navegador.');
      } catch (err) {
        alert('Error: intenta abrir http://192.168.4.1 directamente.');
      }
    });
  </script>
</body>
</html>